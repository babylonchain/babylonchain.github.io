<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-developer-guides/modules/monitor">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">Vigilante Checkpointing Monitor | Babylon Blockchain</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.babylonchain.io/docs/developer-guides/modules/monitor"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Vigilante Checkpointing Monitor | Babylon Blockchain"><meta data-rh="true" name="description" content="Learn what the Babylon Vigilante checkpointing Monitor program is and how it operates."><meta data-rh="true" property="og:description" content="Learn what the Babylon Vigilante checkpointing Monitor program is and how it operates."><link data-rh="true" rel="icon" href="/img/favicon_black.png"><link data-rh="true" rel="canonical" href="https://docs.babylonchain.io/docs/developer-guides/modules/monitor"><link data-rh="true" rel="alternate" href="https://docs.babylonchain.io/docs/developer-guides/modules/monitor" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.babylonchain.io/docs/developer-guides/modules/monitor" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Babylon Blockchain RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Babylon Blockchain Atom Feed"><link rel="stylesheet" href="/assets/css/styles.f9b726a8.css">
<link rel="preload" href="/assets/js/runtime~main.6c76821e.js" as="script">
<link rel="preload" href="/assets/js/main.6e51b13e.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo_black.svg" alt="Babylon" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo_white.svg" alt="Babylon" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href="/docs/introduction/overview">Docs</a><a class="navbar__item navbar__link" href="/docs/developer-guides/grpcrestapi">API</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/babylonchain" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://babylonchain.io/about" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">About<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://babylonchain.io/contact" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Contact<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><main class="docMainContainer_gTbr docMainContainerEnhanced_Uz_u"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col"><div class="docItemContainer_Djhp"><article><div class="theme-doc-markdown markdown"><h1>Vigilante Checkpointing Monitor</h1><p>Learn what the Babylon Vigilante checkpointing Monitor program is and how it operates.</p><hr><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="summary">Summary<a class="hash-link" href="#summary" title="Direct link to heading">​</a></h2><p>The Checkpointing Monitor is a separate process running alongside a Babylon node.
The responsibility of the Checkpointing Monitor to constantly check (1) consistency between the Babylon node and BTC,
and (2) whether the blockchain is under liveness attack.
Once a critical issue is found, it raises an alarm to the user who decides whether to stall the blockchain.
Running a Checkpointing Monitor is optional but highly recommended since it ensures a Babylon node is in a healthy state.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="problem-statement">Problem Statement<a class="hash-link" href="#problem-statement" title="Direct link to heading">​</a></h2><p>The Checkpointing Monitor aims to provide the following properties:</p><ul><li>BTC header chain safety and liveness.
It ensures that the BTC header chain maintained by btclightclient is live and consistent with the BTC canonical chain.</li><li>Babylon checkpoint chain safety and liveness.
It ensures that the checkpoint chain of the Babylon node is live and consistent with that submitted to BTC canonical chain.</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="design">Design<a class="hash-link" href="#design" title="Direct link to heading">​</a></h2><p>The Checkpointing Monitor can be started at any time after the Babylon node is started.
The Checkpointing Monitor initiates by reading some parameters from the genesis file, i.e., validator BLS key set, base BTC height.
Then it goes through a bootstrapping procedure to process checkpoints that have already been submitted to BTC.
After that, it is driven by newly mined BTC blocks.
Note that the monitor only processes a BTC block when it is <code>k-deep</code> where <code>k</code> is a configurable parameter.</p><p>The vigilante checkpointing monitor program makes the following design decisions:</p><ul><li><a href="#consistency-check">Consistency Check</a></li><li><a href="#liveness-check">Liveness Check</a></li></ul><p>In the following description, when we say upon a BTC block, it means the block is already <code>k-deep</code>.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="consistency-check">Consistency Check<a class="hash-link" href="#consistency-check" title="Direct link to heading">​</a></h3><p>The workflow of the Checkpointing Monitor checking consistency of the Babylon ledger against BTC upon a new BTC block is described as the following:</p><ol><li><p>Compare the BTC header with the header at the same height from Babylon.
If they do not match, the alarm is raised.
If the header does not exist in Babylon, send the alarm.</p></li><li><p>Upon a BTC checkpoint found (ignore checkpoints with higher epochs than the current epoch)</p><ul><li>the Checkpointing Monitor verifies the checkpoint using the validator BLS key set <ul><li>if the BLS sig is valid, continue </li><li>otherwise, skip this checkpoint </li></ul></li><li>query the checkpoint from Babylon and checks whether the two checkpoints match on LastCommitHash <ul><li>if matched, extend the checkpoint chain, increase the current epoch, continue </li><li>otherwise, or the Babylon node does not have the checkpoint at the same epoch, the alarm is raised </li></ul></li><li>it updates the validator BLS key set by querying the Babylon node <ul><li>an alarm is raised if the Babylon node does not have the validator BLS key set for the next epoch</li></ul></li></ul></li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="liveness-check">Liveness Check<a class="hash-link" href="#liveness-check" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="definition">Definition<a class="hash-link" href="#definition" title="Direct link to heading">​</a></h4><p>The Checkpointing Monitor should alarm if any of the unique checkpoints (the same checkpoints can have different submitters) with a valid BLS signature is not reported to Babylon within a period of time,
which is measured by BTC height.
We first define some marks of the lifecycle of a unique checkpoint (measured by BTC height):</p><ul><li><strong>H1</strong>: the tip height of <code>btclightclient</code> when the relevant epoch ends (obtained from Babylon)</li><li><strong>H2</strong>: the BTC height at which the checkpoint first appears on BTC (obtained from BTC)</li><li><strong>H3</strong>: the tip height of <code>btclightclient</code> when the checkpoint is reported as a submission (obtained from Babylon)</li><li><strong>H4</strong>: the current tip height of <code>btclightclient</code> when asked (obtained from Babylon)</li></ul><p>We decide a checkpoint is under liveness attack if:</p><ul><li>Happy case (H3 &gt; H2 &gt; H1)<ul><li>H3 - H1 &gt; X (the checkpoint is received by <code>btccheckpoint</code>)</li><li>H4 - H1 &gt; X (the checkpoint is not received by <code>btccheckpoint</code>)</li></ul></li><li>Unhappy case (H2 &lt; H1, the checkpoint is forked and submitted before epoch ends)<ul><li>H3 - H2 &gt; X (the checkpoint is received by <code>btccheckpoint</code>)</li><li>H4 - H2 &gt; X (the checkpoint is not received by <code>btccheckpoint</code>)</li></ul></li></ul><p>For short, we decide a checkpoint is under liveness attack if:</p><ul><li>H3 - min(H1, H2) &gt; X (the checkpoint is received by <code>btccheckpoint</code>)</li><li>H4 - min(H1, H2) &gt; X (the checkpoint is not received by <code>btccheckpoint</code>)</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="bookkeeping">Bookkeeping<a class="hash-link" href="#bookkeeping" title="Direct link to heading">​</a></h4><p>The checkpointing monitor uses the following table for bookkeeping.
For each newly scanned checkpoint with a valid BLS sig, the checkpointing monitor records its epoch number, H2 and the status of <code>not_reported</code></p><table><thead><tr><th>Epoch</th><th>Checkpoint id</th><th>H2</th><th>Status</th></tr></thead><tbody><tr><td>1</td><td></td><td>10</td><td>reported</td></tr><tr><td>2</td><td></td><td>20</td><td>reported</td></tr><tr><td>3</td><td></td><td>30</td><td>not_reported</td></tr></tbody></table><p>We implement a new module called <code>monitor</code> in Babylon to provide all the data (e.g., H1, H3, H4) that is needed by the vigilante Checkpointing Monitor.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="workflow">Workflow<a class="hash-link" href="#workflow" title="Direct link to heading">​</a></h4><p>For every t seconds (a configurable parameter), the Checkpointing Monitor identifies <code>not_reported</code> checkpoints and asks btccheckpoint to check whether each checkpoint is reported:</p><ul><li>If so, check the <code>gap = H3 - min(H1, H2)</code>; <ul><li>if <code>gap &gt; X</code>, change the status to <code>censored</code> and send the alarm. </li><li>Otherwise, change the status to <code>reported</code> and check the next checkpoint </li></ul></li><li>Otherwise, check the <code>gap = H4 - min(H1, H2)</code>; <ul><li>if <code>gap &gt; X</code>, change the status to <code>censored</code> and send the alarm. </li><li>Otherwise, check the next checkpoint</li></ul></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/developer-guides/modules/monitor.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"></nav></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/introduction/overview">Documentation</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.linkedin.com/company/babylon-chain" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.twitter.com/babylon_chain" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UCmnied_wAVVa2ECVLQH2OLQ" target="_blank" rel="noopener noreferrer" class="footer__link-item">Youtube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://babylonchain.io/blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li></ul></div></div></div></footer></div>
<script src="/assets/js/runtime~main.6c76821e.js"></script>
<script src="/assets/js/main.6e51b13e.js"></script>
</body>
</html>