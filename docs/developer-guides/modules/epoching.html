<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-developer-guides/modules/epoching">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">Epoching Module | Babylon Blockchain</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.babylonchain.io/docs/developer-guides/modules/epoching"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Epoching Module | Babylon Blockchain"><meta data-rh="true" name="description" content="Learn what the Babylon Epoching Module is and how it operates."><meta data-rh="true" property="og:description" content="Learn what the Babylon Epoching Module is and how it operates."><link data-rh="true" rel="icon" href="/img/favicon_black.png"><link data-rh="true" rel="canonical" href="https://docs.babylonchain.io/docs/developer-guides/modules/epoching"><link data-rh="true" rel="alternate" href="https://docs.babylonchain.io/docs/developer-guides/modules/epoching" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.babylonchain.io/docs/developer-guides/modules/epoching" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Babylon Blockchain RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Babylon Blockchain Atom Feed"><link rel="stylesheet" href="/assets/css/styles.f9b726a8.css">
<link rel="preload" href="/assets/js/runtime~main.c6fc9989.js" as="script">
<link rel="preload" href="/assets/js/main.d1f70064.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo_black.svg" alt="Babylon" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo_white.svg" alt="Babylon" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/introduction/overview">Docs</a><a class="navbar__item navbar__link" href="/docs/developer-guides/grpcrestapi">API</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/babylonchain" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://babylonchain.io/about" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">About<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://babylonchain.io/contact" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Contact<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_mhZE sidebarWithHideableNavbar__6UL"><a tabindex="-1" class="sidebarLogo_F_0z" href="/"><img src="/img/logo_black.svg" alt="Babylon" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo_white.svg" alt="Babylon" class="themedImage_ToTc themedImage--dark_i4oU"><b></b></a><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/docs/introduction/overview">Introduction</a><button aria-label="Toggle the collapsible sidebar category &#x27;Introduction&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/introduction/babylon-overview">Babylon Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/introduction/btc-staking/overview">Bitcoin Staking</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/introduction/btc-timestamping/overview">Bitcoin Timestamping</a><button aria-label="Toggle the collapsible sidebar category &#x27;Bitcoin Timestamping&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/faq/overview">FAQ</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/docs/user-guides/overview">User Guides</a><button aria-label="Toggle the collapsible sidebar category &#x27;User Guides&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/user-guides/installation">Installation</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/user-guides/btc-timestamping-testnet/overview">Bitcoin Timestamping Testnet</a><button aria-label="Toggle the collapsible sidebar category &#x27;Bitcoin Timestamping Testnet&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/user-guides/finality-providers/overview">Finality Providers</a><button aria-label="Toggle the collapsible sidebar category &#x27;Finality Providers&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/developer-guides/overview">Developer Guides</a><button aria-label="Toggle the collapsible sidebar category &#x27;Developer Guides&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/developer-guides/modules/overview">Modules</a><button aria-label="Toggle the collapsible sidebar category &#x27;Modules&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/developer-guides/modules/epoching">Epoching Module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer-guides/modules/checkpointing">Checkpointing Module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer-guides/modules/btccheckpoint">BTC Checkpoint Module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer-guides/modules/btclightclient">BTC Light Client Module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer-guides/modules/czconcierge">Zone Concierge Module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer-guides/modules/submitter">Vigilante Submitter Program</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer-guides/modules/reporter">Vigilante Reporter Program</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer-guides/modules/monitor">Vigilante Monitor Program</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer-guides/grpcrestapi">gRPC Gateway (REST API)</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/papers">Papers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/support">Support</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/cli/babylond/cli">CLI Reference</a><button aria-label="Toggle the collapsible sidebar category &#x27;CLI Reference&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/developer-guides/overview"><span itemprop="name">Developer Guides</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/developer-guides/modules/overview"><span itemprop="name">Modules</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Epoching Module</span><meta itemprop="position" content="3"></li></ul></nav><div class="theme-doc-markdown markdown"><h1>Epoching Module</h1><p>Learn what the Babylon Epoching Module is and how it operates.</p><hr><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="summary">Summary<a class="hash-link" href="#summary" title="Direct link to heading">​</a></h2><p>The epoching module is responsible for reducing and parameterising the frequency of updating the validator set in Babylon.
The Babylon blockchain is divided into epochs, and each epoch contains a fixed number of consecutive blocks.
All staking-related messages (creating validator, delegating, undelegating, and redelegating) are enqueued to the message queue of the current epoch.
At the end of each epoch, the epoching module will execute all staking-related messages, then update the validator set w.r.t. the voting power distribution of validators.
After that, the checkpointing module will generate a checkpoint containing the commitment to the epoch&#x27;s validator set, then submit the checkpoint to Bitcoin.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="problem-statement">Problem Statement<a class="hash-link" href="#problem-statement" title="Direct link to heading">​</a></h2><p>In Cosmos SDK, the validator set can change upon every block: staking-related messages that affect the validator set’s voting power distribution (e.g., bond/unbond, delegate/undelegate/redegate, slash) can be executed in any block.
Since checkpointing the validator set to Bitcoin is necessary for Babylon to obtain Bitcoin security, the frequency of checkpointing to Bitcoin has to be same as the frequency of validator set updates.
If the validator set changes upon every block, then Babylon has to checkpoint to Bitcoin upon every new block, which is impractical given Bitcoin&#x27;s block interval of 10 minutes.
In addition, the Cosmos community also observed that frequent validator set updates make it challenging to implement threshold cryptography, light clients, fair leader election, and staking derivatives, as discussed in <a href="https://github.com/cosmos/cosmos-sdk/blob/main/docs/architecture/adr-039-epoched-staking.md" target="_blank" rel="noopener noreferrer">ADR-039</a>.</p><p>In order to reduce the frequency of validator set updates, a natural solution is to implement the epoching mechanism (aka epoched staking), which divides the blockchain into epochs and triggers a validator set update per epoch.
The idea of epoching was proposed and formalised in <a href="https://github.com/cosmos/cosmos-sdk/blob/main/docs/architecture/adr-039-epoched-staking.md" target="_blank" rel="noopener noreferrer">ADR-039</a>, and there have been multiple efforts (<a href="https://github.com/cosmos/cosmos-sdk/pull/8829" target="_blank" rel="noopener noreferrer">https://github.com/cosmos/cosmos-sdk/pull/8829</a>, <a href="https://github.com/cosmos/cosmos-sdk/pull/10132" target="_blank" rel="noopener noreferrer">https://github.com/cosmos/cosmos-sdk/pull/10132</a>, <a href="https://github.com/cosmos/cosmos-sdk/pull/10173" target="_blank" rel="noopener noreferrer">https://github.com/cosmos/cosmos-sdk/pull/10173</a>) of implementing it.
Since Babylon has some extra design goals (e.g., checkpointing epochs) and these efforts have discontinued, Babylon implements its own epoching module.</p><p>In addition, in order to achieve slashable safety, Babylon has to implement Bitcoin-assisted unbonding, where an unbonding request is finished only when the corresponding block has been checkpointed on Bitcoin.
With the epoching mechanism, all unbonding requests in an epoch will be finished upon this epoch has been checkpointed on Bitcoin.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="design">Design<a class="hash-link" href="#design" title="Direct link to heading">​</a></h2><p>Babylon implements the epoching module in order to reduce the frequency of validator set updates, and thus the frequency of checkpointing to Bitcoin.
Specifically, the epoching module is responsible for the following tasks:</p><ul><li>Dividing the blockchain into epochs</li><li>Disabling some functionalities of the staking module</li><li>Disabling messages of the staking module</li><li>Delaying staking-related messages (thus validator set updates) till the end of the epoch</li><li>Releasing the unbonding queue until the corresponding epoch has been checkpointed on Bitcoin.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="dividing-the-blockchain-into-epochs">Dividing the Blockchain into Epochs<a class="hash-link" href="#dividing-the-blockchain-into-epochs" title="Direct link to heading">​</a></h3><p>The epoching mechanism introduces the concept of epochs.
The blockchain is divided into epochs, each consists of a fixed number of consecutive blocks.
The number of blocks in an epoch is called <em>epoch interval</em>, which is a system parameter.
At the moment, Babylon uses the epoch interval of 900 blocks, which take about 30 minutes.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="disabling-functionalities-of-the-staking-module">Disabling Functionalities of the Staking Module<a class="hash-link" href="#disabling-functionalities-of-the-staking-module" title="Direct link to heading">​</a></h3><p>Babylon disables two functionalities of the staking module, namely the validator set update mechanism and the 21-day unbonding mechanism.</p><p>In Cosmos SDK, the staking module handles staking-related messages and updates the validator set upon every block.
Consequently, the staking module updates the validator set upon every block.
In order to reduce the frequency of validator set updates to once per epoch, Babylon disables the validator set update mechanism of the staking module.</p><p>In addition, the staking module enforces the 21-day unbonding rule: an unbonding validator or delegation will become unbonded after 21 days (called *mature validators**).
Babylon departs from Cosmos SDK by employing Bitcoin-assisted unbonding that leverages Bitcoin security to achieve slashable safety, where a validator has to be slashed if performing a safety attack.
In order to implement Bitcoin-assisted unbonding, Babylon disables the 21-day unbonding mechanism as well.</p><p>In order to disable the two functionalities, Babylon disables staking module&#x27;s <code>EndBlocker</code> function that updates validator sets and unbonds mature validators upon a block ends.
Instead, upon an epoch has ended, the epoching module will invoke the staking module&#x27;s function that updates the validator sets.
In addition, upon an epoch has been checkpointed to Bitcoin, the epoching module will  invoke the staking module&#x27;s function that unbonds mature validators.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="disabling-messages-of-the-staking-module">Disabling Messages of the Staking Module<a class="hash-link" href="#disabling-messages-of-the-staking-module" title="Direct link to heading">​</a></h3><p>In order to keep the validator set unchanged in the middle of epochs, the epoching module intercepts and rejects staking-related messages that affect validator sets via AnteHandler, but instead defines wrapped versions of them and forwards their unwrapped forms to the staking module upon an epoch ends.</p><p>Recall that a Cosmos SDK module contains protobuf files for messages in transactions.
In the staking module, these messages include </p><ul><li><code>MsgCreateValidator</code> for creating a new validator</li><li><code>MsgEditValidator</code> for editing an existing validator</li><li><code>MsgDelegate</code> for delegating coins from a delegator to a validator</li><li><code>MsgBeginRedelegate</code> for redelegating coins from a delegator and source validator to a destination validator.</li><li><code>MsgUndelegate</code> for undelegating from a delegator and a validator.</li><li><code>MsgCancelUnbondingDelegation</code> for cancelling unbonding delegation for a delegator</li></ul><p>Within these messages, <code>MsgCreateValidator</code>, <code>MsgDelegate</code>, <code>MsgBeginRedelegate</code>, and <code>MsgUndelegate</code> affect the validator set.
Since Babylon requires the validator set to be unchanged within an epoch, it has to avoid processing these messages in the middle of epochs.
To this end, the epoching module defines an AnteHandler to reject these messages.
Instead, it defines wrapped versions for them in the epoching module: <code>MsgWrappedCreateValidator</code>, <code>MsgWrappedDelegate</code>, <code>MsgWrappedBeginRedelegate</code>, and <code>MsgWrappedUndelegate</code>.
The epoching module receives these messages at any time, but will only process them at the end of each epoch.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="delaying-wrapped-messages-to-the-end-of-epochs">Delaying Wrapped Messages to the End of Epochs<a class="hash-link" href="#delaying-wrapped-messages-to-the-end-of-epochs" title="Direct link to heading">​</a></h3><p>The epoching module will handle wrapped staking-related messages at the end of each epoch.
To this end, the epoching module maintains a message queue for each epoch.
Upon each wrapped message, the epoching module performs basic sanity checks, then enqueue the message to the message queue.
When the epoch ends, the epoching module will unwrap the queued messages and forward them to the staking module.
Consequently, the staking module receives and handles staking-related messages, thus performs validator set updates, at the end of each epoch.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="bitcoin-assisted-unbonding">Bitcoin-assisted Unbonding<a class="hash-link" href="#bitcoin-assisted-unbonding" title="Direct link to heading">​</a></h3><p>Bitcoin-assisted unbonding is the mechanism that an unbonding validator or delegation becomes unbonded only when the block containing the associated unbonding request is checkpointed by Bitcoin.
The mechanism is necessary for achieving slashable safety where a validator has to be slashed if performing a safety attack.</p><p>Babylon implements the Bitcoin-assisted unbonding mechanism by invoking the staking module upon an epoch becomes checkpointed.
Specifically, the staking module&#x27;s <code>ApplyMatureUnbondings</code> is responsible for identifying and unbonding mature validators and delegations that have been unbonding for 21 days, and is invoked upon every block.
Babylon has disabled the invocation of <code>ApplyMatureUnbondings</code> per block, and implements the state management for epochs.
Upon an epoch becomes finalized, the epoching module will invoke <code>ApplyMatureUnbondings</code> to unbond all unbonding validators and delegations before the end of this epoch.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/developer-guides/modules/epoching.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/developer-guides/modules/overview"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Babylon Modules</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/developer-guides/modules/checkpointing"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Checkpointing Module</div></a></nav></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/introduction/overview">Documentation</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.linkedin.com/company/babylon-chain" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.twitter.com/babylon_chain" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UCmnied_wAVVa2ECVLQH2OLQ" target="_blank" rel="noopener noreferrer" class="footer__link-item">Youtube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://babylonchain.io/blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li></ul></div></div></div></footer></div>
<script src="/assets/js/runtime~main.c6fc9989.js"></script>
<script src="/assets/js/main.d1f70064.js"></script>
</body>
</html>